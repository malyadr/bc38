variables:
    SONAR_USER_HOME: '${CI_PROJECT_DIR}/.sonar' # Defines the location of the analysis task cache
    GIT_DEPTH: '0' # Tells git to fetch all the branches of the project, required by the analysis task

stages:
    - sonarcloud-check-frontend

sonarcloud-check-frontend:
    stage: sonarcloud-check-frontend
    image:
        name: node:16
        name: sonarsource/sonar-scanner-cli:latest
        entrypoint: ['']
    cache:
        key: '${CI_JOB_NAME}'
        paths:
            - .sonar/cache
    script:
        - npm install --legacy-peer-deps
        - npm test
        - sonar-scanner
    only:
        - merge_requests
        - main
